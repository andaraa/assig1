!function(window,document,undefined){function is(obj,type){return typeof obj===type}function testRunner(){var featureNames,feature,aliasIdx,result,nameIdx,featureName,featureNameSplit;for(var featureIdx in tests){if(featureNames=[],feature=tests[featureIdx],feature.name&&(featureNames.push(feature.name.toLowerCase()),feature.options&&feature.options.aliases&&feature.options.aliases.length))for(aliasIdx=0;aliasIdx<feature.options.aliases.length;aliasIdx++)featureNames.push(feature.options.aliases[aliasIdx].toLowerCase());for(result=is(feature.fn,"function")?feature.fn():feature.fn,nameIdx=0;nameIdx<featureNames.length;nameIdx++)featureName=featureNames[nameIdx],featureNameSplit=featureName.split("."),1===featureNameSplit.length?Modernizr[featureNameSplit[0]]=result:(!Modernizr[featureNameSplit[0]]||Modernizr[featureNameSplit[0]]instanceof Boolean||(Modernizr[featureNameSplit[0]]=new Boolean(Modernizr[featureNameSplit[0]])),Modernizr[featureNameSplit[0]][featureNameSplit[1]]=result),classes.push((result?"":"no-")+featureNameSplit.join("-"))}}function createElement(){return"function"!=typeof document.createElement?document.createElement(arguments[0]):isSVG?document.createElementNS.call(document,"http://www.w3.org/2000/svg",arguments[0]):document.createElement.apply(document,arguments)}function contains(str,substr){return!!~(""+str).indexOf(substr)}function getBody(){var body=document.body;return body||(body=createElement(isSVG?"svg":"body"),body.fake=!0),body}function injectElementWithStyles(rule,callback,nodes,testnames){var style,ret,node,docOverflow,mod="modernizr",div=createElement("div"),body=getBody();if(parseInt(nodes,10))for(;nodes--;)node=createElement("div"),node.id=testnames?testnames[nodes]:mod+(nodes+1),div.appendChild(node);return style=createElement("style"),style.type="text/css",style.id="s"+mod,(body.fake?body:div).appendChild(style),body.appendChild(div),style.styleSheet?style.styleSheet.cssText=rule:style.appendChild(document.createTextNode(rule)),div.id=mod,body.fake&&(body.style.background="",body.style.overflow="hidden",docOverflow=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(body)),ret=callback(div,rule),body.fake?(body.parentNode.removeChild(body),docElement.style.overflow=docOverflow,docElement.offsetHeight):div.parentNode.removeChild(div),!!ret}function domToCSS(name){return name.replace(/([A-Z])/g,function(str,m1){return"-"+m1.toLowerCase()}).replace(/^ms-/,"-ms-")}function nativeTestProps(props,value){var i=props.length;if("CSS"in window&&"supports"in window.CSS){for(;i--;)if(window.CSS.supports(domToCSS(props[i]),value))return!0;return!1}if("CSSSupportsRule"in window){for(var conditionText=[];i--;)conditionText.push("("+domToCSS(props[i])+":"+value+")");return conditionText=conditionText.join(" or "),injectElementWithStyles("@supports ("+conditionText+") { #modernizr { position: absolute; } }",function(node){return"absolute"==getComputedStyle(node,null).position})}return undefined}function cssToDOM(name){return name.replace(/([a-z])-([a-z])/g,function(str,m1,m2){return m1+m2.toUpperCase()}).replace(/^-/,"")}function testProps(props,prefixed,value,skipValueTest){function cleanElems(){afterInit&&(delete mStyle.style,delete mStyle.modElem)}if(skipValueTest=is(skipValueTest,"undefined")?!1:skipValueTest,!is(value,"undefined")){var result=nativeTestProps(props,value);if(!is(result,"undefined"))return result}for(var afterInit,i,propsLength,prop,before,elems=["modernizr","tspan"];!mStyle.style;)afterInit=!0,mStyle.modElem=createElement(elems.shift()),mStyle.style=mStyle.modElem.style;for(propsLength=props.length,i=0;propsLength>i;i++)if(prop=props[i],before=mStyle.style[prop],contains(prop,"-")&&(prop=cssToDOM(prop)),mStyle.style[prop]!==undefined){if(skipValueTest||is(value,"undefined"))return cleanElems(),"pfx"==prefixed?prop:!0;try{mStyle.style[prop]=value}catch(e){}if(mStyle.style[prop]!=before)return cleanElems(),"pfx"==prefixed?prop:!0}return cleanElems(),!1}function fnBind(fn,that){return function(){return fn.apply(that,arguments)}}function testDOMProps(props,obj,elem){var item;for(var i in props)if(props[i]in obj)return elem===!1?props[i]:(item=obj[props[i]],is(item,"function")?fnBind(item,elem||obj):item);return!1}function testPropsAll(prop,prefixed,elem,value,skipValueTest){var ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+" "+cssomPrefixes.join(ucProp+" ")+ucProp).split(" ");return is(prefixed,"string")||is(prefixed,"undefined")?testProps(props,prefixed,value,skipValueTest):(props=(prop+" "+domPrefixes.join(ucProp+" ")+ucProp).split(" "),testDOMProps(props,prefixed,elem))}function setClasses(classes){var className=docElement.className,classPrefix=Modernizr._config.classPrefix||"";if(isSVG&&(className=className.baseVal),Modernizr._config.enableJSClass){var reJS=new RegExp("(^|\\s)"+classPrefix+"no-js(\\s|$)");className=className.replace(reJS,"$1"+classPrefix+"js$2")}Modernizr._config.enableClasses&&(className+=" "+classPrefix+classes.join(" "+classPrefix),isSVG?docElement.className.baseVal=className:docElement.className=className)}function addTest(feature,test){if("object"==typeof feature)for(var key in feature)hasOwnProp(feature,key)&&addTest(key,feature[key]);else{feature=feature.toLowerCase();var featureNameSplit=feature.split("."),last=Modernizr[featureNameSplit[0]];if(2==featureNameSplit.length&&(last=last[featureNameSplit[1]]),"undefined"!=typeof last)return Modernizr;test="function"==typeof test?test():test,1==featureNameSplit.length?Modernizr[featureNameSplit[0]]=test:(!Modernizr[featureNameSplit[0]]||Modernizr[featureNameSplit[0]]instanceof Boolean||(Modernizr[featureNameSplit[0]]=new Boolean(Modernizr[featureNameSplit[0]])),Modernizr[featureNameSplit[0]][featureNameSplit[1]]=test),setClasses([(test&&0!=test?"":"no-")+featureNameSplit.join("-")]),Modernizr._trigger(feature,test)}return Modernizr}var tests=[],ModernizrProto={_version:"3.0.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(test,cb){var self=this;setTimeout(function(){cb(self[test])},0)},addTest:function(name,fn,options){tests.push({name:name,fn:fn,options:options})},addAsyncTest:function(fn){tests.push({name:null,fn:fn})}},Modernizr=function(){};Modernizr.prototype=ModernizrProto,Modernizr=new Modernizr;var classes=[],docElement=document.documentElement,isSVG="svg"===docElement.nodeName.toLowerCase();Modernizr.addTest("canvas",function(){var elem=createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))}),Modernizr.addTest("placeholder","placeholder"in createElement("input")&&"placeholder"in createElement("textarea"));var omPrefixes="Moz O ms Webkit",domPrefixes=ModernizrProto._config.usePrefixes?omPrefixes.toLowerCase().split(" "):[];ModernizrProto._domPrefixes=domPrefixes;var cssomPrefixes=ModernizrProto._config.usePrefixes?omPrefixes.split(" "):[];ModernizrProto._cssomPrefixes=cssomPrefixes;var modElem={elem:createElement("modernizr")};Modernizr._q.push(function(){delete modElem.elem});var mStyle={style:modElem.elem.style};Modernizr._q.unshift(function(){delete mStyle.style}),ModernizrProto.testAllProps=testPropsAll;var atRule=function(prop){var rule,length=prefixes.length,cssrule=window.CSSRule;if("undefined"==typeof cssrule)return undefined;if(!prop)return!1;if(prop=prop.replace(/^@/,""),rule=prop.replace(/-/g,"_").toUpperCase()+"_RULE",rule in cssrule)return"@"+prop;for(var i=0;length>i;i++){var prefix=prefixes[i],thisRule=prefix.toUpperCase()+"_"+rule;if(thisRule in cssrule)return"@-"+prefix.toLowerCase()+"-"+prop}return!1};ModernizrProto.atRule=atRule;var prefixed=ModernizrProto.prefixed=function(prop,obj,elem){return 0===prop.indexOf("@")?atRule(prop):(-1!=prop.indexOf("-")&&(prop=cssToDOM(prop)),obj?testPropsAll(prop,obj,elem):testPropsAll(prop,"pfx"))};Modernizr.addTest("fullscreen",!(!prefixed("exitFullscreen",document,!1)&&!prefixed("cancelFullScreen",document,!1))),Modernizr.addTest("geolocation","geolocation"in navigator),Modernizr.addTest("svg",!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var prefixes=ModernizrProto._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):[];ModernizrProto._prefixes=prefixes;var testStyles=ModernizrProto.testStyles=injectElementWithStyles;Modernizr.addTest("touchevents",function(){var bool;if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)bool=!0;else{var query=["@media (",prefixes.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");testStyles(query,function(node){bool=9===node.offsetTop})}return bool});var hasOwnProp;!function(){var _hasOwnProperty={}.hasOwnProperty;hasOwnProp=is(_hasOwnProperty,"undefined")||is(_hasOwnProperty.call,"undefined")?function(object,property){return property in object&&is(object.constructor.prototype[property],"undefined")}:function(object,property){return _hasOwnProperty.call(object,property)}}(),ModernizrProto._l={},ModernizrProto.on=function(feature,cb){this._l[feature]||(this._l[feature]=[]),this._l[feature].push(cb),Modernizr.hasOwnProperty(feature)&&setTimeout(function(){Modernizr._trigger(feature,Modernizr[feature])},0)},ModernizrProto._trigger=function(feature,res){if(this._l[feature]){var cbs=this._l[feature];setTimeout(function(){var i,cb;for(i=0;i<cbs.length;i++)(cb=cbs[i])(res)},0),delete this._l[feature]}},Modernizr._q.push(function(){ModernizrProto.addTest=addTest}),Modernizr.addAsyncTest(function(){function testOver32kb(){var datauriBig=new Image;datauriBig.onerror=function(){addTest("datauri",!0),Modernizr.datauri=new Boolean(!0),Modernizr.datauri.over32kb=!1},datauriBig.onload=function(){addTest("datauri",!0),Modernizr.datauri=new Boolean(!0),Modernizr.datauri.over32kb=1==datauriBig.width&&1==datauriBig.height};for(var base64str="R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";base64str.length<33e3;)base64str="\r\n"+base64str;datauriBig.src="data:image/gif;base64,"+base64str}-1!==navigator.userAgent.indexOf("MSIE 7.")&&setTimeout(function(){addTest("datauri",!1)},10);var datauri=new Image;datauri.onerror=function(){addTest("datauri",!1)},datauri.onload=function(){1==datauri.width&&1==datauri.height?testOver32kb():addTest("datauri",!1)},datauri.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}),Modernizr.addTest("webworkers","Worker"in window),testRunner(),delete ModernizrProto.addTest,delete ModernizrProto.addAsyncTest;for(var i=0;i<Modernizr._q.length;i++)Modernizr._q[i]();window.Modernizr=Modernizr}(window,document);var emb;!function(emb){!function(messagebus){var ChannelRegistry=function(){function ChannelRegistry(){}return ChannelRegistry}();messagebus.ChannelRegistry=ChannelRegistry}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){!function(MessageType){MessageType[MessageType.SUBSCRIBE=0]="SUBSCRIBE",MessageType[MessageType.UNSUBSCRIBE=1]="UNSUBSCRIBE",MessageType[MessageType.MESSAGE=2]="MESSAGE"}(messagebus.MessageType||(messagebus.MessageType={}));messagebus.MessageType}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var Message=function(){function Message(){this.header={clientId:"",channel:"",type:2},this.body={message:"",timestamp:""}}return Message}();messagebus.Message=Message}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){!function(CommunicationType){CommunicationType[CommunicationType.INLINE=0]="INLINE",CommunicationType[CommunicationType.IFRAME=1]="IFRAME"}(messagebus.CommunicationType||(messagebus.CommunicationType={}));messagebus.CommunicationType}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},emb;!function(emb){!function(messagebus){var ErrorClass=function(){function ErrorClass(message){this.message=message}return ErrorClass}();messagebus.ErrorClass=ErrorClass;var MessageBusError=function(_super){function MessageBusError(message){_super.call(this,message),this.message=message,this.name="MessageBusError"}return __extends(MessageBusError,_super),MessageBusError}(ErrorClass);messagebus.MessageBusError=MessageBusError}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var Message=(emb.messagebus.MessageType,emb.messagebus.Message),ChannelRegistry=emb.messagebus.ChannelRegistry,MessageBusConnection=function(){function MessageBusConnection(clientId){this.clientId=clientId,this.channelRegistry=new ChannelRegistry}return MessageBusConnection.connect=function(clientId){if("string"!=typeof clientId||MessageBusConnection.isEmpty(clientId))throw new TypeError("Please provide a valid clientId");var connection=new MessageBusConnection(clientId);if("undefined"==typeof emb_messagebus_mbServer){if(window.parent===window)throw new messagebus.MessageBusError("Connection could not be established");connection.communicationType=1,window.addEventListener?addEventListener("message",connection.messageReceived.bind(connection),!1):attachEvent("onmessage",connection.messageReceived.bind(connection))}else connection.communicationType=0,emb_messagebus_mbClients[clientId]=connection.messageReceived.bind(connection);return connection},MessageBusConnection.prototype.messageReceived=function(event){var objectToParse;objectToParse="string"==typeof event?event:event.data;var message;try{message=JSON.parse(objectToParse)}catch(ex){}if(void 0!==message){var channelId=message.header.channel,registeredCallback=this.channelRegistry[channelId];void 0!==registeredCallback&&setTimeout(registeredCallback(message.body),0)}},MessageBusConnection.prototype.subscribe=function(channelId,callback){if("string"!=typeof channelId||MessageBusConnection.isEmpty(channelId))throw new TypeError("Please provide a valid channelId");if("function"!=typeof callback)throw new TypeError("You haven't provided a function as callback arg");var message=this.buildMessage(0,channelId);this.channelRegistry[channelId]=callback,this.sendMessage(message)},MessageBusConnection.prototype.unsubscribe=function(channelId){if("string"!=typeof channelId||MessageBusConnection.isEmpty(channelId))throw new TypeError("Please provide a valid channelId");var message=this.buildMessage(1,channelId);this.channelRegistry.hasOwnProperty(channelId)&&(this.channelRegistry[channelId]=void 0,this.sendMessage(message))},MessageBusConnection.prototype.publish=function(channelId,clientMessage){if("string"!=typeof channelId||MessageBusConnection.isEmpty(channelId))throw new TypeError("Please provide a valid channelId");if("string"!=typeof clientMessage)throw new TypeError("You haven't provided a string as message");var message=this.buildMessage(2,channelId,clientMessage);this.sendMessage(message)},MessageBusConnection.prototype.buildMessage=function(type,channelId,clientMessage){var message=new Message;return message.header.clientId=this.clientId,message.header.channel=channelId,message.header.type=type,message.body.timestamp=(new Date).toLocaleString(),message.body.message=clientMessage||"",message},MessageBusConnection.prototype.sendMessage=function(message){var jsonMessage=JSON.stringify(message);if(1===this.communicationType)try{window.parent.postMessage(jsonMessage,"*")}catch(err){throw new messagebus.MessageBusError("An error occured on window.postMessage! "+err)}else 0===this.communicationType&&emb_messagebus_mbServer.receiveMessage(jsonMessage)},MessageBusConnection.isEmpty=function(value){return void 0===value||null===value||""===value},MessageBusConnection}();messagebus.MessageBusConnection=MessageBusConnection}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){!function(CommunicationType){CommunicationType[CommunicationType.INLINE=0]="INLINE",CommunicationType[CommunicationType.IFRAME=1]="IFRAME"}(messagebus.CommunicationType||(messagebus.CommunicationType={}));messagebus.CommunicationType}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var ClientConnection=function(){function ClientConnection(clientId,communicationType){this.clientId=clientId,this.communicationType=communicationType}return ClientConnection}();messagebus.ClientConnection=ClientConnection}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){!function(MessageType){MessageType[MessageType.SUBSCRIBE=0]="SUBSCRIBE",MessageType[MessageType.UNSUBSCRIBE=1]="UNSUBSCRIBE",MessageType[MessageType.MESSAGE=2]="MESSAGE"}(messagebus.MessageType||(messagebus.MessageType={}));messagebus.MessageType}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var Message=function(){function Message(){this.header={clientId:"",channel:"",type:2},this.body={message:"",timestamp:""}}return Message}();messagebus.Message=Message}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var Channel=function(){function Channel(channelId){this.latestMessage=null,this.connections=new Array,this.channelId=channelId}return Channel}();messagebus.Channel=Channel}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var ConnectionRegistry=function(){function ConnectionRegistry(){}return ConnectionRegistry}();messagebus.ConnectionRegistry=ConnectionRegistry}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb;!function(emb){!function(messagebus){var ConnectionRegistry=(emb.messagebus.MessageType,emb.messagebus.ConnectionRegistry),ClientConnection=emb.messagebus.ClientConnection,Channel=emb.messagebus.Channel,Server=(emb.messagebus.CommunicationType,function(){function Server(){this.logger=null,this.connectionRegistry=new ConnectionRegistry,"undefined"==typeof emb_messagebus_mbClients&&(emb_messagebus_mbClients=new Object)}return Server.startUp=function(){var serverInstance;return serverInstance=new emb.messagebus.Server,window.addEventListener?addEventListener("message",serverInstance.receiveMessage.bind(serverInstance),!1):attachEvent("onmessage",serverInstance.receiveMessage.bind(serverInstance)),serverInstance},Server.prototype.receiveMessage=function(messageContainer){var message,clientConnection;if("string"==typeof messageContainer){try{message=JSON.parse(messageContainer)}catch(ex){}if(this.checkMessageStructure(message)!==!0)return;message&&(clientConnection=new ClientConnection(message.header.clientId,0))}else{if(!messageContainer.data||"undefined"==typeof messageContainer.data||"string"!=typeof messageContainer.data)return;try{message=JSON.parse(messageContainer.data)}catch(ex){}if(this.checkMessageStructure(message)!==!0)return;message&&(clientConnection=new ClientConnection(message.header.clientId,1),clientConnection.source=messageContainer.source,clientConnection.origin=messageContainer.origin)}null!==this.logger&&this.logger(message),message&&(0===message.header.type?this.subscribeClientToChannel(message,clientConnection):1===message.header.type?this.unsubscribeClientFromChannel(message,clientConnection):this.broadcastMessage(message))},Server.prototype.broadcastMessage=function(message){var channelId=message.header.channel,channel=this.connectionRegistry[channelId];"undefined"==typeof channel&&(this.connectionRegistry[channelId]=new Channel(channelId),channel=this.connectionRegistry[channelId]),channel.latestMessage=message;var clients=channel.connections;if("undefined"!=typeof clients)for(var i=0;i<clients.length;i++){var client=clients[i];this.sendMessage(client,message)}},Server.prototype.subscribeClientToChannel=function(message,client){var registeredClients,channelId=message.header.channel,channel=this.connectionRegistry[channelId];"undefined"==typeof channel&&(channel=new Channel(channelId)),registeredClients=channel.connections;for(var alreadyRegistered=!1,i=0;i<registeredClients.length;i++)if(registeredClients[i].clientId===client.clientId){alreadyRegistered=!0;break}alreadyRegistered||registeredClients.push(client),this.connectionRegistry[channelId]=channel,null!==channel.latestMessage&&this.sendMessage(client,channel.latestMessage)},Server.prototype.unsubscribeClientFromChannel=function(message,client){var channelId=message.header.channel,channel=this.connectionRegistry[channelId];if("undefined"!=typeof channel){for(var registeredClients=channel.connections,index=-1,i=0;i<registeredClients.length;i++)if(registeredClients[i].clientId===client.clientId){index=i;break}-1!==index&&registeredClients.splice(i,1)}},Server.prototype.sendMessage=function(client,message){1===client.communicationType?client.source.postMessage(JSON.stringify(message),"*"):0===client.communicationType&&"undefined"!=typeof emb_messagebus_mbClients[client.clientId]&&null!==emb_messagebus_mbClients[client.clientId]&&emb_messagebus_mbClients[client.clientId](JSON.stringify(message))},Server.prototype.registerLogger=function(logger){this.logger=logger},Server.prototype.checkMessageStructure=function(message){var defaultMessage=new messagebus.Message;if(defaultMessage===message)return!0;if(message)for(var i in defaultMessage){if(!message.hasOwnProperty(i))return!1;for(var innerAttributes in defaultMessage[i])if(!message[i].hasOwnProperty(innerAttributes))return!1}return!0},Server}());messagebus.Server=Server}(emb.messagebus||(emb.messagebus={}));emb.messagebus}(emb||(emb={}));var emb_messagebus_mbServer=emb.messagebus.Server.startUp();!function(undefined){"use strict";function addEventListener(el,evt,func){"addEventListener"in window?el.addEventListener(evt,func,!1):"attachEvent"in window&&el.attachEvent("on"+evt,func)}function removeEventListener(el,evt,func){"removeEventListener"in window?el.removeEventListener(evt,func,!1):"detachEvent"in window&&el.detachEvent("on"+evt,func)}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function throttle(func){var context,args,result,timeout=null,previous=0,later=function(){previous=getNow(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=getNow();previous||(previous=now);var remaining=throttledTimer-(now-previous);return context=this,args=arguments,0>=remaining||remaining>throttledTimer?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||(timeout=setTimeout(later,remaining)),result}}function formatLogMsg(msg){return msgID+"["+myID+"] "+msg}function log(msg){logging&&"object"==typeof window.console&&console.log(formatLogMsg(msg))}function warn(msg){"object"==typeof window.console&&console.warn(formatLogMsg(msg))}function init(){readDataFromParent(),log("Initialising iFrame ("+location.href+")"),readDataFromPage(),setMargin(),setBodyStyle("background",bodyBackground),setBodyStyle("padding",bodyPadding),injectClearFixIntoBodyElement(),checkHeightMode(),checkWidthMode(),stopInfiniteResizingOfIFrame(),setupPublicMethods(),startEventListeners(),inPageLinks=setupInPageLinks(),sendSize("init","Init message from host page"),readyCallback()}function readDataFromParent(){function strBool(str){return"true"===str?!0:!1}var data=initMsg.substr(msgIdLen).split(":");myID=data[0],bodyMargin=undefined!==data[1]?Number(data[1]):bodyMargin,calculateWidth=undefined!==data[2]?strBool(data[2]):calculateWidth,logging=undefined!==data[3]?strBool(data[3]):logging,interval=undefined!==data[4]?Number(data[4]):interval,autoResize=undefined!==data[6]?strBool(data[6]):autoResize,bodyMarginStr=data[7],heightCalcMode=undefined!==data[8]?data[8]:heightCalcMode,bodyBackground=data[9],bodyPadding=data[10],tolerance=undefined!==data[11]?Number(data[11]):tolerance,inPageLinks.enable=undefined!==data[12]?strBool(data[12]):!1,resizeFrom=undefined!==data[13]?data[13]:resizeFrom,widthCalcMode=undefined!==data[14]?data[14]:widthCalcMode}function readDataFromPage(){function readData(){var data=window.iFrameResizer;log("Reading data from page: "+JSON.stringify(data)),messageCallback="messageCallback"in data?data.messageCallback:messageCallback,readyCallback="readyCallback"in data?data.readyCallback:readyCallback,targetOriginDefault="targetOrigin"in data?data.targetOrigin:targetOriginDefault,heightCalcMode="heightCalculationMethod"in data?data.heightCalculationMethod:heightCalcMode,widthCalcMode="widthCalculationMethod"in data?data.widthCalculationMethod:widthCalcMode}function setupCustomCalcMethods(calcMode,calcFunc){return"function"==typeof calcMode&&(log("Setup custom "+calcFunc+"CalcMethod"),customCalcMethods[calcFunc]=calcMode,calcMode="custom"),calcMode}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(readData(),heightCalcMode=setupCustomCalcMethods(heightCalcMode,"height"),widthCalcMode=setupCustomCalcMethods(widthCalcMode,"width")),log("TargetOrigin for parent set to: "+targetOriginDefault)}function chkCSS(attr,value){return-1!==value.indexOf("-")&&(warn("Negative CSS value ignored for "+attr),value=""),value}function setBodyStyle(attr,value){undefined!==value&&""!==value&&"null"!==value&&(document.body.style[attr]=value,log("Body "+attr+' set to "'+value+'"'))}function setMargin(){undefined===bodyMarginStr&&(bodyMarginStr=bodyMargin+"px"),setBodyStyle("margin",chkCSS("margin",bodyMarginStr))}function stopInfiniteResizingOfIFrame(){document.documentElement.style.height="",document.body.style.height="",log('HTML & body height set to "auto"')}function manageTriggerEvent(options){var listener={add:function(eventName){function handleEvent(){sendSize(options.eventName,options.eventType)}eventHandlersByName[eventName]=handleEvent,addEventListener(window,eventName,handleEvent)},remove:function(eventName){var handleEvent=eventHandlersByName[eventName];delete eventHandlersByName[eventName],removeEventListener(window,eventName,handleEvent)}};options.eventNames&&Array.prototype.map?(options.eventName=options.eventNames[0],options.eventNames.map(listener[options.method])):listener[options.method](options.eventName),log(capitalizeFirstLetter(options.method)+" event listener: "+options.eventType)}function manageEventListeners(method){manageTriggerEvent({method:method,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),manageTriggerEvent({method:method,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),manageTriggerEvent({method:method,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),manageTriggerEvent({method:method,eventType:"Input",eventName:"input"}),manageTriggerEvent({method:method,eventType:"Mouse Up",eventName:"mouseup"}),manageTriggerEvent({method:method,eventType:"Mouse Down",eventName:"mousedown"}),manageTriggerEvent({method:method,eventType:"Orientation Change",eventName:"orientationchange"}),manageTriggerEvent({method:method,eventType:"Print",eventName:["afterprint","beforeprint"]}),manageTriggerEvent({method:method,eventType:"Ready State Change",eventName:"readystatechange"}),manageTriggerEvent({method:method,eventType:"Touch Start",eventName:"touchstart"}),manageTriggerEvent({method:method,eventType:"Touch End",eventName:"touchend"}),manageTriggerEvent({method:method,eventType:"Touch Cancel",eventName:"touchcancel"}),manageTriggerEvent({method:method,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),manageTriggerEvent({method:method,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),manageTriggerEvent({method:method,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),"child"===resizeFrom&&manageTriggerEvent({method:method,eventType:"IFrame Resized",eventName:"resize"})}function checkCalcMode(calcMode,calcModeDefault,modes,type){return calcModeDefault!==calcMode&&(calcMode in modes||(warn(calcMode+" is not a valid option for "+type+"CalculationMethod."),calcMode=calcModeDefault),log(type+' calculation method set to "'+calcMode+'"')),calcMode}function checkHeightMode(){heightCalcMode=checkCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,"height")}function checkWidthMode(){widthCalcMode=checkCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,"width")}function startEventListeners(){!0===autoResize?(manageEventListeners("add"),setupMutationObserver()):log("Auto Resize disabled")}function stopMsgsToParent(){log("Disable outgoing messages"),sendPermit=!1}function removeMsgListener(){log("Remove event listener: Message"),removeEventListener(window,"message",receiver)}function disconnectMutationObserver(){null!==bodyObserver&&bodyObserver.disconnect()}function stopEventListeners(){manageEventListeners("remove"),disconnectMutationObserver(),clearInterval(intervalTimer)}function teardown(){stopMsgsToParent(),removeMsgListener(),!0===autoResize&&stopEventListeners()}function injectClearFixIntoBodyElement(){var clearFix=document.createElement("div");clearFix.style.clear="both",clearFix.style.display="block",document.body.appendChild(clearFix)}function setupInPageLinks(){function getPagePosition(){return{x:window.pageXOffset!==undefined?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop}}function getElementPosition(el){var elPosition=el.getBoundingClientRect(),pagePosition=getPagePosition();return{x:parseInt(elPosition.left,10)+parseInt(pagePosition.x,10),y:parseInt(elPosition.top,10)+parseInt(pagePosition.y,10)}}function findTarget(location){function jumpToTarget(target){var jumpPosition=getElementPosition(target);log("Moving to in page link (#"+hash+") at x: "+jumpPosition.x+" y: "+jumpPosition.y),sendMsg(jumpPosition.y,jumpPosition.x,"scrollToOffset")}var hash=location.split("#")[1]||location,hashData=decodeURIComponent(hash),target=document.getElementById(hashData)||document.getElementsByName(hashData)[0];undefined!==target?jumpToTarget(target):(log("In page link (#"+hash+") not found in iFrame, so sending to parent"),sendMsg(0,0,"inPageLink","#"+hash))}function checkLocationHash(){""!==location.hash&&"#"!==location.hash&&findTarget(location.href)}function bindAnchors(){function setupLink(el){function linkClicked(e){e.preventDefault(),findTarget(this.getAttribute("href"))}"#"!==el.getAttribute("href")&&addEventListener(el,"click",linkClicked)}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),setupLink)}function bindLocationHash(){addEventListener(window,"hashchange",checkLocationHash)}function initCheck(){setTimeout(checkLocationHash,eventCancelTimer)}function enableInPageLinks(){Array.prototype.forEach&&document.querySelectorAll?(log("Setting up location.hash handlers"),bindAnchors(),bindLocationHash(),initCheck()):warn("In page linking not fully supported in this browser! (See README.md for IE8 workaround)")}return inPageLinks.enable?enableInPageLinks():log("In page linking not enabled"),{findTarget:findTarget}}function setupPublicMethods(){log("Enable public methods"),win.parentIFrame={autoResize:function(resize){return!0===resize&&!1===autoResize?(autoResize=!0,startEventListeners()):!1===resize&&!0===autoResize&&(autoResize=!1,stopEventListeners()),autoResize},close:function(){sendMsg(0,0,"close"),teardown()},getId:function(){return myID},getPageInfo:function(callback){"function"==typeof callback?(pageInfoCallback=callback,sendMsg(0,0,"pageInfo")):(pageInfoCallback=function(){},sendMsg(0,0,"pageInfoStop"))},moveToAnchor:function(hash){inPageLinks.findTarget(hash);
},reset:function(){resetIFrame("parentIFrame.reset")},scrollTo:function(x,y){sendMsg(y,x,"scrollTo")},scrollToOffset:function(x,y){sendMsg(y,x,"scrollToOffset")},sendMessage:function(msg,targetOrigin){sendMsg(0,0,"message",JSON.stringify(msg),targetOrigin)},setHeightCalculationMethod:function(heightCalculationMethod){heightCalcMode=heightCalculationMethod,checkHeightMode()},setWidthCalculationMethod:function(widthCalculationMethod){widthCalcMode=widthCalculationMethod,checkWidthMode()},setTargetOrigin:function(targetOrigin){log("Set targetOrigin: "+targetOrigin),targetOriginDefault=targetOrigin},size:function(customHeight,customWidth){var valString=""+(customHeight?customHeight:"")+(customWidth?","+customWidth:"");sendSize("size","parentIFrame.size("+valString+")",customHeight,customWidth)}}}function initInterval(){0!==interval&&(log("setInterval: "+interval+"ms"),intervalTimer=setInterval(function(){sendSize("interval","setInterval: "+interval)},Math.abs(interval)))}function setupBodyMutationObserver(){function addImageLoadListners(mutation){function addImageLoadListener(element){!1===element.complete&&(log("Attach listeners to "+element.src),element.addEventListener("load",imageLoaded,!1),element.addEventListener("error",imageError,!1),elements.push(element))}"attributes"===mutation.type&&"src"===mutation.attributeName?addImageLoadListener(mutation.target):"childList"===mutation.type&&Array.prototype.forEach.call(mutation.target.querySelectorAll("img"),addImageLoadListener)}function removeFromArray(element){elements.splice(elements.indexOf(element),1)}function removeImageLoadListener(element){log("Remove listeners from "+element.src),element.removeEventListener("load",imageLoaded,!1),element.removeEventListener("error",imageError,!1),removeFromArray(element)}function imageEventTriggered(event,type,typeDesc){removeImageLoadListener(event.target),sendSize(type,typeDesc+": "+event.target.src,undefined,undefined)}function imageLoaded(event){imageEventTriggered(event,"imageLoad","Image loaded")}function imageError(event){imageEventTriggered(event,"imageLoadFailed","Image load failed")}function mutationObserved(mutations){sendSize("mutationObserver","mutationObserver: "+mutations[0].target+" "+mutations[0].type),mutations.forEach(addImageLoadListners)}function createMutationObserver(){var target=document.querySelector("body"),config={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};return observer=new MutationObserver(mutationObserved),log("Create body MutationObserver"),observer.observe(target,config),observer}var elements=[],MutationObserver=window.MutationObserver||window.WebKitMutationObserver,observer=createMutationObserver();return{disconnect:function(){"disconnect"in observer&&(log("Disconnect body MutationObserver"),observer.disconnect(),elements.forEach(removeImageLoadListener))}}}function setupMutationObserver(){var forceIntervalTimer=0>interval;window.MutationObserver||window.WebKitMutationObserver?forceIntervalTimer?initInterval():bodyObserver=setupBodyMutationObserver():(log("MutationObserver not supported in this browser!"),initInterval())}function getComputedStyle(prop,el){function convertUnitsToPxForIE8(value){var PIXEL=/^\d+(px)?$/i;if(PIXEL.test(value))return parseInt(value,base);var style=el.style.left,runtimeStyle=el.runtimeStyle.left;return el.runtimeStyle.left=el.currentStyle.left,el.style.left=value||0,value=el.style.pixelLeft,el.style.left=style,el.runtimeStyle.left=runtimeStyle,value}var retVal=0;return el=el||document.body,"defaultView"in document&&"getComputedStyle"in document.defaultView?(retVal=document.defaultView.getComputedStyle(el,null),retVal=null!==retVal?retVal[prop]:0):retVal=convertUnitsToPxForIE8(el.currentStyle[prop]),parseInt(retVal,base)}function chkEventThottle(timer){timer>throttledTimer/2&&(throttledTimer=2*timer,log("Event throttle increased to "+throttledTimer+"ms"))}function getMaxElement(side,elements){for(var elementsLength=elements.length,elVal=0,maxVal=0,Side=capitalizeFirstLetter(side),timer=getNow(),i=0;elementsLength>i;i++)elVal=elements[i].getBoundingClientRect()[side]+getComputedStyle("margin"+Side,elements[i]),elVal>maxVal&&(maxVal=elVal);return timer=getNow()-timer,log("Parsed "+elementsLength+" HTML elements"),log("Element position calculated in "+timer+"ms"),chkEventThottle(timer),maxVal}function getAllMeasurements(dimention){return[dimention.bodyOffset(),dimention.bodyScroll(),dimention.documentElementOffset(),dimention.documentElementScroll()]}function getTaggedElements(side,tag){function noTaggedElementsFound(){return warn("No tagged elements ("+tag+") found on page"),document.querySelectorAll("body *")}var elements=document.querySelectorAll("["+tag+"]");return 0===elements.length&&noTaggedElementsFound(),getMaxElement(side,elements)}function getAllElements(){return document.querySelectorAll("body *")}function sizeIFrame(triggerEvent,triggerEventDesc,customHeight,customWidth){function resizeIFrame(){height=currentHeight,width=currentWidth,sendMsg(height,width,triggerEvent)}function isSizeChangeDetected(){function checkTolarance(a,b){var retVal=Math.abs(a-b)<=tolerance;return!retVal}return currentHeight=undefined!==customHeight?customHeight:getHeight[heightCalcMode](),currentWidth=undefined!==customWidth?customWidth:getWidth[widthCalcMode](),checkTolarance(height,currentHeight)||calculateWidth&&checkTolarance(width,currentWidth)}function isForceResizableEvent(){return!(triggerEvent in{init:1,interval:1,size:1})}function isForceResizableCalcMode(){return heightCalcMode in resetRequiredMethods||calculateWidth&&widthCalcMode in resetRequiredMethods}function logIgnored(){log("No change in size detected")}function checkDownSizing(){isForceResizableEvent()&&isForceResizableCalcMode()?resetIFrame(triggerEventDesc):triggerEvent in{interval:1}||logIgnored()}var currentHeight,currentWidth;isSizeChangeDetected()||"init"===triggerEvent?(lockTrigger(),resizeIFrame()):checkDownSizing()}function sendSize(triggerEvent,triggerEventDesc,customHeight,customWidth){function recordTrigger(){triggerEvent in{reset:1,resetPage:1,init:1}||log("Trigger event: "+triggerEventDesc)}function isDoubleFiredEvent(){return triggerLocked&&triggerEvent in doubleEventList}isDoubleFiredEvent()?log("Trigger event cancelled: "+triggerEvent):(recordTrigger(),sizeIFrameThrottled(triggerEvent,triggerEventDesc,customHeight,customWidth))}function lockTrigger(){triggerLocked||(triggerLocked=!0,log("Trigger event lock on")),clearTimeout(triggerLockedTimer),triggerLockedTimer=setTimeout(function(){triggerLocked=!1,log("Trigger event lock off"),log("--")},eventCancelTimer)}function triggerReset(triggerEvent){height=getHeight[heightCalcMode](),width=getWidth[widthCalcMode](),sendMsg(height,width,triggerEvent)}function resetIFrame(triggerEventDesc){var hcm=heightCalcMode;heightCalcMode=heightCalcModeDefault,log("Reset trigger event: "+triggerEventDesc),lockTrigger(),triggerReset("reset"),heightCalcMode=hcm}function sendMsg(height,width,triggerEvent,msg,targetOrigin){function setTargetOrigin(){undefined===targetOrigin?targetOrigin=targetOriginDefault:log("Message targetOrigin: "+targetOrigin)}function sendToParent(){var size=height+":"+width,message=myID+":"+size+":"+triggerEvent+(undefined!==msg?":"+msg:"");log("Sending message to host page ("+message+")"),target.postMessage(msgID+message,targetOrigin)}!0===sendPermit&&(setTargetOrigin(),sendToParent())}function receiver(event){function isMessageForUs(){return msgID===(""+event.data).substr(0,msgIdLen)}function getMessageType(){return event.data.split("]")[1].split(":")[0]}function getData(){return event.data.substr(event.data.indexOf(":")+1)}function isMiddleTier(){return!("undefined"!=typeof module&&module.exports)&&"iFrameResize"in window}function isInitMsg(){return event.data.split(":")[2]in{"true":1,"false":1}}function callFromParent(){var messageType=getMessageType();messageType in processRequestFromParent?processRequestFromParent[messageType]():isMiddleTier()||isInitMsg()||warn("Unexpected message ("+event.data+")")}function processMessage(){!1===firstRun?callFromParent():isInitMsg()?processRequestFromParent.init():log('Ignored message of type "'+getMessageType()+'". Received before initialization.')}var processRequestFromParent={init:function(){function fireInit(){initMsg=event.data,target=event.source,init(),firstRun=!1,setTimeout(function(){initLock=!1},eventCancelTimer)}document.body?fireInit():(log("Waiting for page ready"),addEventListener(window,"readystatechange",processRequestFromParent.initFromParent))},reset:function(){initLock?log("Page reset ignored by init"):(log("Page size reset by host page"),triggerReset("resetPage"))},resize:function(){sendSize("resizeParent","Parent window requested size check")},moveToAnchor:function(){inPageLinks.findTarget(getData())},inPageLink:function(){this.moveToAnchor()},pageInfo:function(){var msgBody=getData();log("PageInfoFromParent called from parent: "+msgBody),pageInfoCallback(JSON.parse(msgBody)),log(" --")},message:function(){var msgBody=getData();log("MessageCallback called from parent: "+msgBody),messageCallback(JSON.parse(msgBody)),log(" --")}};isMessageForUs()&&processMessage()}function chkLateLoaded(){"loading"!==document.readyState&&window.parent.postMessage("[iFrameResizerChild]Ready","*")}if("undefined"!=typeof window){var autoResize=!0,base=10,bodyBackground="",bodyMargin=0,bodyMarginStr="",bodyObserver=null,bodyPadding="",calculateWidth=!1,doubleEventList={resize:1,click:1},eventCancelTimer=128,firstRun=!0,height=1,heightCalcModeDefault="bodyOffset",heightCalcMode=heightCalcModeDefault,initLock=!0,initMsg="",inPageLinks={},interval=32,intervalTimer=null,logging=!1,msgID="[iFrameSizer]",msgIdLen=msgID.length,myID="",resetRequiredMethods={max:1,min:1,bodyScroll:1,documentElementScroll:1},resizeFrom="child",sendPermit=!0,target=window.parent,targetOriginDefault="*",tolerance=0,triggerLocked=!1,triggerLockedTimer=null,throttledTimer=16,width=1,widthCalcModeDefault="scroll",widthCalcMode=widthCalcModeDefault,win=window,messageCallback=function(){warn("MessageCallback function not defined")},readyCallback=function(){},pageInfoCallback=function(){},customCalcMethods={height:function(){return warn("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return warn("Custom width calculation function not defined"),document.body.scrollWidth}},eventHandlersByName={},getNow=Date.now||function(){return(new Date).getTime()},getHeight={bodyOffset:function(){return document.body.offsetHeight+getComputedStyle("marginTop")+getComputedStyle("marginBottom")},offset:function(){return getHeight.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return customCalcMethods.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,getAllMeasurements(getHeight))},min:function(){return Math.min.apply(null,getAllMeasurements(getHeight))},grow:function(){return getHeight.max()},lowestElement:function(){return Math.max(getHeight.bodyOffset(),getMaxElement("bottom",getAllElements()))},taggedElement:function(){return getTaggedElements("bottom","data-iframe-height")}},getWidth={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return customCalcMethods.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(getWidth.bodyScroll(),getWidth.documentElementScroll())},max:function(){return Math.max.apply(null,getAllMeasurements(getWidth))},min:function(){return Math.min.apply(null,getAllMeasurements(getWidth))},rightMostElement:function(){return getMaxElement("right",getAllElements())},taggedElement:function(){return getTaggedElements("right","data-iframe-width")}},sizeIFrameThrottled=throttle(sizeIFrame);addEventListener(window,"message",receiver),chkLateLoaded()}}();